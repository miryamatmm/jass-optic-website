import{_ as F}from"./SFsWL7fw.js";import{f as N,c as m,o as d,a as t,t as v,g as l,_ as P,r as u,h as T,i as O,j,b as w,w as B,F as z,k as E,d as V,l as $,v as g,m as k,n as L}from"./dDCsOtge.js";const M={class:"card slot-card"},q={class:"slot-info"},A=["disabled"],H={key:0},I={key:1},K={__name:"SlotCard",props:{slot:{type:Object,required:!0}},setup(a){const f=a,b=N(()=>new Date(f.slot.date).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}));return(n,o)=>(d(),m("div",M,[t("div",q,[t("strong",null,v(l(b)),1),t("div",null,v(a.slot.start_time)+" ‚Üí "+v(a.slot.end_time),1)]),t("button",{class:"btn",disabled:a.slot.reserved,onClick:o[0]||(o[0]=c=>n.$emit("select",a.slot))},[a.slot.reserved?(d(),m("span",I,"D√©j√† r√©serv√©")):(d(),m("span",H,"R√©server"))],8,A)]))}},G={class:"file-upload card"},J=["for"],Q=["id"],W={key:0,class:"file-name"},X={__name:"FileUpload",props:{label:String,id:String},emits:["update:file"],setup(a,{emit:f}){const b=f,n=u("");function o(c){const r=c.target.files[0];r&&(n.value=r.name,b("update:file",r))}return(c,r)=>(d(),m("div",G,[t("label",{for:a.id,class:"label"},v(a.label),9,J),t("input",{id:a.id,type:"file",class:"input",onChange:o,accept:".pdf, image/*"},null,40,Q),l(n)?(d(),m("div",W," üìÑ "+v(l(n)),1)):T("",!0)]))}},x=P(X,[["__scopeId","data-v-3f086eeb"]]),Y={class:"page reservation"},Z={key:0,class:"card success"},ee={key:1},te={class:"card"},se={key:0,class:"selected-info"},ne={class:"card"},le={class:"card"},ae=["disabled"],ie={__name:"reserver",setup(a){const f=j(),b=u([]),n=u(null),o=u(""),c=u(""),r=u(""),_=u(""),C=u(null),D=u(null),y=u(!1),S=u(!1);O(async()=>{const p=await $fetch(`${f.public.supabaseUrl}/rest/v1/slots?select=*`,{headers:{apikey:f.public.supabaseAnonKey}});p.sort((e,i)=>{const s=new Date(e.date+"T"+e.start_time),h=new Date(i.date+"T"+i.start_time);return s-h}),b.value=p});async function R(p,e){if(!p)return null;const i=new FormData;return i.append("file",p),i.append("type",e),(await $fetch("/api/upload",{method:"POST",body:i})).url}async function U(){if(!n.value)return alert("Choisissez un cr√©neau");if(!o.value||!c.value||!r.value||!_.value)return alert("Tous les champs sont obligatoires");y.value=!0;const p=await R(C.value,"ordonnances"),e=await R(D.value,"mutuelle"),i=await $fetch("/api/reserve",{method:"POST",body:{slot_id:n.value.id,firstname:o.value,lastname:c.value,email:r.value,phone:_.value,ordonnance_url:p,mutuelle_url:e}});if(i.error){alert("Erreur : "+i.error);return}(await $fetch("/api/send-email",{method:"POST",body:{email:r.value,firstname:o.value,lastname:c.value,phone:_.value,slotDate:n.value.date,slotHour:`${n.value.start_time} ‚Üí ${n.value.end_time}`}}))?.error&&alert("R√©servation confirm√©e, mais l‚Äôemail n‚Äôa pas pu √™tre envoy√©."),y.value=!1,S.value=!0}return(p,e)=>{const i=F;return d(),m("div",Y,[e[17]||(e[17]=t("h1",null," R√©server votre cr√©neau ",-1)),l(S)?(d(),m("div",Z,[e[8]||(e[8]=t("h2",null,"R√©servation confirm√©e",-1)),e[9]||(e[9]=t("p",{class:"sub"}," Votre demande a bien √©t√© enregistr√©e. Nous vous contacterons rapidement. ",-1)),w(i,{to:"/",class:"btn cta"},{default:B(()=>[...e[7]||(e[7]=[V(" Retour √† l‚Äôaccueil ",-1)])]),_:1})])):(d(),m("div",ee,[t("div",te,[e[11]||(e[11]=t("h2",null,"Choisissez un cr√©neau",-1)),e[12]||(e[12]=t("p",{class:"step-desc"}," S√©lectionnez l‚Äôhoraire qui vous convient. ",-1)),(d(!0),m(z,null,E(l(b),s=>(d(),L(K,{key:s.id,slot:s,onSelect:e[0]||(e[0]=h=>n.value=h)},null,8,["slot"]))),128)),l(n)?(d(),m("p",se,[e[10]||(e[10]=V(" Cr√©neau s√©lectionn√© : ",-1)),t("strong",null,v(l(n).start_time)+" ‚Üí "+v(l(n).end_time),1)])):T("",!0)]),t("div",ne,[e[13]||(e[13]=t("h2",null,"Vos informations",-1)),e[14]||(e[14]=t("p",{class:"step-desc"}," Ces informations nous permettent de pr√©parer votre dossier. ",-1)),$(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>k(o)?o.value=s:null),class:"input",placeholder:"Pr√©nom"},null,512),[[g,l(o)]]),$(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>k(c)?c.value=s:null),class:"input",placeholder:"Nom"},null,512),[[g,l(c)]]),$(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>k(r)?r.value=s:null),class:"input",placeholder:"Adresse email"},null,512),[[g,l(r)]]),$(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>k(_)?_.value=s:null),class:"input",placeholder:"T√©l√©phone"},null,512),[[g,l(_)]])]),t("div",le,[e[15]||(e[15]=t("h2",null,"Documents",-1)),e[16]||(e[16]=t("p",{class:"step-desc"}," Merci de joindre les documents n√©cessaires. ",-1)),w(x,{label:"Ordonnance",id:"ordonnance","onUpdate:file":e[5]||(e[5]=s=>C.value=s)}),w(x,{label:"Carte mutuelle",id:"mutuelle","onUpdate:file":e[6]||(e[6]=s=>D.value=s)})]),t("button",{class:"btn cta-full",onClick:U,disabled:l(y)},v(l(y)?"Envoi en cours...":"Confirmer la r√©servation"),9,ae)]))])}}};export{ie as default};
