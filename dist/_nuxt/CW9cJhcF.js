import{r as _,i as D,c as a,a as n,h as C,g as h,t as i,F as v,k as f,o,d as j}from"./dDCsOtge.js";const E={class:"page admin-reservations"},T={class:"admin-header"},V={key:0,class:"badge"},S={class:"date-title"},x={class:"reservation-header"},A={key:0,class:"status validated"},L={key:1,class:"status pending"},M={class:"contact"},N={class:"slot-info"},B={class:"documents"},F={class:"download-row"},O=["href"],R={key:1,class:"download-empty"},J={class:"download-row"},P=["href"],q={key:1,class:"download-empty"},z={class:"btn-row"},G=["disabled","onClick"],H=["onClick"],Q={__name:"reservations",setup(I){const p=_([]),c=_(0),m=_({});async function u(){const s=await $fetch("/api/admin/get-reservations");p.value=s.reservations,c.value=s.newCount;const t={};s.reservations.forEach(e=>{if(!e.slot?.date)return;const l=e.slot.date.split("T")[0];t[l]||(t[l]=[]),t[l].push(e)});const r=Object.keys(t).sort(),d={};r.forEach(e=>{d[e]=t[e]}),m.value=d}D(u);async function g(s){confirm("Annuler cette réservation ?")&&(await $fetch(`/api/admin/cancel-reservation/${s}`,{method:"DELETE"}),u())}async function k(s){await $fetch(`/api/admin/validate-reservation/${s}`,{method:"POST"}),u()}function y(s){if(!s?.date)return"";const t=new Date(s.date),r=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],d=["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],e=r[t.getDay()],l=t.getDate(),w=d[t.getMonth()],b=s.start_time.slice(0,5),$=s.end_time.slice(0,5);return`${e} ${l} ${w} — ${b} → ${$}`}return(s,t)=>(o(),a("div",E,[n("div",T,[t[0]||(t[0]=n("h1",null,"Réservations",-1)),h(c)>0?(o(),a("div",V,i(h(c))+" en attente ",1)):C("",!0)]),(o(!0),a(v,null,f(h(m),(r,d)=>(o(),a("div",{key:d},[n("h2",S,i(new Date(d).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})),1),(o(!0),a(v,null,f(r,e=>(o(),a("div",{class:"card reservation-card",key:e.id},[n("div",x,[n("h3",null,i(e.firstname)+" "+i(e.lastname),1),e.validated?(o(),a("span",A," Validée ")):(o(),a("span",L," En attente "))]),n("p",M,i(e.email)+" · "+i(e.phone),1),n("p",N,[t[1]||(t[1]=n("strong",null,"Créneau :",-1)),j(" "+i(y(e.slot)),1)]),n("div",B,[n("div",F,[t[2]||(t[2]=n("span",null,"Ordonnance",-1)),e.ordonnance_url?(o(),a("a",{key:0,href:e.ordonnance_url,class:"download-pill",target:"_blank"}," Télécharger ",8,O)):(o(),a("span",R," Aucun fichier "))]),n("div",J,[t[3]||(t[3]=n("span",null,"Carte mutuelle",-1)),e.mutuelle_url?(o(),a("a",{key:0,href:e.mutuelle_url,class:"download-pill",target:"_blank"}," Télécharger ",8,P)):(o(),a("span",q," Aucun fichier "))])]),n("div",z,[n("button",{class:"btn",disabled:e.validated,onClick:l=>!e.validated&&k(e.id)},i(e.validated?"Déjà validée":"Valider"),9,G),n("button",{class:"btn danger",onClick:l=>g(e.id)}," Annuler ",8,H)])]))),128))]))),128))]))}};export{Q as default};
